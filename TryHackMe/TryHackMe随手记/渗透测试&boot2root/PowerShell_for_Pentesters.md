# PowerShell for Pentesters

您是否具有直接外壳访问权限并尝试 以土地为生或使用命令控制基础设施，例如 作为盟约，PowerShell是一个强大的工具。本节 将涵盖PowerShell的基础知识，这些基础知识在任何参与中都很有用。

---

### 文件操作

#### 获取进程

Get-Process可用于列出所有正在运行的进程。

它也可以是 与 “-name” 参数一起使用以筛选特定进程 名字。

#### 获取内容

类似于 Linux 上的 “cat” 和 Windows 上的 “type” 命令行，“Get-Content”可用于显示 一个文件。

#### 复制项目

文件 可以使用“Copy-Item”和“Move-Item”进行复制和移动， 分别。

#### 获取文件哈希

虽然 与渗透测试没有直接关系，哈希很方便 在以下平台上比较文件或搜索恶意软件样本 病毒总计。内置的 “Get-FileHash -Algorithm” 命令可用于 获取大多数格式的哈希。

---

### 下载文件

    (New-Object System.Net.WebClient).Downloadfile("URL")

一次 脚本已经下载，您可能会遇到第一个相关的 PowerShell：ExecutionPolicy。重要的是要注意，作为 微软在相关文档中明确指出， “ExecutionPolicy” 不是安全功能。它只是功能 作为额外的安全措施，用户可以绕过。 

这 可以使用以下命令查看执行策略配置的当前状态 "Get-ExecutionPolicy -list"

执行 策略可以有七个不同的值;

    AllSigned：脚本可以运行，但要求所有脚本都由受信任的脚本签名 发行人。
    Bypass: 所有脚本都可以运行，并且不会显示任何警告或提示.
    Default：这是指 Windows 客户端的“受限”和 Windows 服务器的“远程签名”.
    RemoteSigned: 脚本可以运行，这不需要本地脚本 数字签名.
    Restricted: Windows 客户端的默认配置。允许单个命令 运行，不允许脚本.
    Undefined: 这表明未设置特定的执行策略。这意味着默认 将强制执行执行策略.
    Unrestricted: 大多数脚本将运行.

如 前面提到，执行策略不是一个安全功能，可以 被用户绕过。用户有几种替代方法可以绕过 执行政策;但是，某些方法可能需要用户具有 管理员帐户权限。

这 绕过执行策略的最常见方法如下所示：

    powershell -ExecutionPolicy Bypass

另一个 选项可以是将“Set-ExecutionPolicy Bypass”与为进程设置的范围一起使用。“-scope” 参数将设置执行 策略仅适用于当前 PowerShell 会话，并将返回到 电源外壳会话关闭后的初始设置。 

另一个 从远程服务器下载文件的简单方法是使用 “Invoke-WebRequest” 命令。

---

### 网络侦测

探测主机存活：

    1..254 | %{ping -n 1 10.10.10.$_ | select-String ttl}

扫描端口：

    1..65534 | %{echo ((New-Object Net.Sockets.TcpClient).Connect("ip", $_)) "Open port on - $_ "} 2>$null

---

### PowerView

(略)
