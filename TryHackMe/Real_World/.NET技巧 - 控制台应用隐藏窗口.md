# .NET技巧 - 控制台应用隐藏窗口

## 前言

起初我通过C#创建控制台应用程序免杀shellcode加载器时，默认会启动一个cmd控制台窗口

但当我们希望将其免杀loader用于钓鱼时，我们必然不希望出现这种情况。在执行进程迁移、进程注入、进程镂空等持久化权限维持操作前，目标手动关闭该cmd控制台窗口后，我们的shell就没了

## 初步尝试

由于是控制台应用程序，它不像WPF那样能够直接调用相关函数来实现隐藏窗口。

我先后多次通过windows api的CloseWindow、GetConsoleWindow和DestroyWindow函数

CloseWindow只能最小化窗口，也就是出现在桌面的底部栏，这样的效果并不太好，我们需要的是无窗口。

而DestroyWindow无法生效，它无法销毁其它线程的窗口

	线程不能使用 DestroyWindow 销毁由其他线程创建的窗口。

## 解决方案 - csc本身

寻找了许多方法，在 不在加载器本身做进程注入，并且又能没有窗口

最简单的方法还是回到了csc.exe本身，因为我们使用csc对C#代码进行编译，我查看了csc的help

![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/3cc0149814334391be2d3b1e80b52664.png)

果然存在这个选项，默认是控制台程序，当我们在编译时，手动添加`/target:winexe`，它将不会再有控制台窗口。

## 结束

我们一直都在企图通过windows api来隐藏窗口和关闭窗口兜圈，忽略了csc编译时的可选项，直接在编译阶段处理这个问题，不过还好思路转了过来

本文旨在介绍如何在C#控制台应用程序中实现隐蔽性，尤其是在开发免杀shellcode加载器时。传统的控制台应用启动时会弹出cmd窗口，这在进行进程保护和注入等操作时可能会暴露风险。我们尝试了多种使用Windows API的方法来隐藏或关闭窗口，但效果不尽如人意。

最终，我们意识到最有效的解决方案是直接在编译阶段调整设置。通过在使用csc.exe编译时添加/target:winexe选项，可以避免窗口的弹出。这一策略不仅简化了开发过程，还增强了应用程序的隐蔽性。